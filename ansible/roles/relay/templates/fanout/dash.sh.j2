#!/bin/sh

ffmpeg -v warning -nostats -nostdin -y -analyzeduration 1000000 \
	-i http://{{ relay_fanout.pull_endpoint }}/s{{ item }}_vpx \
	-c:v copy \
	-map 0:v:0 -b:v:0 2800k \
	-map 0:v:1 -b:v:1 800k \
	-map 0:v:2 -b:v:2 100k \
	\
	-c:a copy \
	-map 0:a:0 -b:a:0 96k \
	-map 0:a:1 -b:a:1 96k \
	-map 0:a:2 -b:a:2 96k \
	\
	-f dash \
	-window_size 20 -extra_window_size 10 -min_seg_duration 6000000 \
	-init_seg_name 'init_$RepresentationID$.hdr' \
	-media_seg_name 'segment_$RepresentationID$_$Time$.chk' \
    -adaptation_sets 'id=0,streams=v id=1,streams=a' \
    {{ relay_fanout.dash_write_path }}/s{{ item }}/manifest.mpd
